# 后台批量处理使用指南

## 快速开始

### 1. 启动后台处理
```bash
# 启动后台处理（默认目录）
python manager.py start

# 启动并立即监控日志
python manager.py start --watch
```

### 2. 查看状态
```bash
python manager.py status
```

### 3. 监控日志
```bash
# 实时监控日志
python manager.py logs

# 查看最近日志
python manager.py recent
```

### 4. 停止处理
```bash
python manager.py stop
```

## 高级用法

### 指定目录和过滤条件
```bash
# 处理特定目录
python manager.py start --base-dir "/path/to/your/pdfs"

# 只处理包含"10.1"的目录
python manager.py start --filter "10.1"

# 组合使用
python manager.py start --base-dir "/home/qxx/report" --filter "10.1"
```

### 直接使用 run_batch_auto.py
```bash
# 后台运行
python run_batch_auto.py --daemon

# 查看状态
python run_batch_auto.py --status

# 停止任务
python run_batch_auto.py --stop

# 预览模式
python run_batch_auto.py --dry-run
```

## 状态文件说明

系统会在 `logs/batch_status.json` 中保存当前处理状态：
- `status`: running/completed/stopped/error
- `current_directory`: 当前处理的目录
- `processed`: 已处理的目录数
- `total`: 总目录数
- `failed`: 失败的目录数
- `start_time`: 开始时间
- `last_update`: 最后更新时间

## 日志文件

- 主日志：`logs/auto_batch_YYYY-MM-DD_HHMM.log`
- 后台日志：`logs/daemon_YYYY-MM-DD_HHMM.log`
- 各目录日志：`logs/run_目录名_YYYY-MM-DD_HHMM.log`

## 断线重连处理

脚本支持断线重连：
1. SSH断开不影响后台运行
2. 重新连接后使用 `python manager.py status` 查看状态
3. 使用 `python manager.py logs` 继续监控日志

## 故障排除

### 任务无法启动
```bash
# 检查是否有任务在运行
python manager.py status

# 强制停止（如果有卡死的任务）
python manager.py stop
```

### 查看详细错误
```bash
# 查看最近的错误日志
python manager.py recent --lines 100

# 查看特定目录的日志
ls logs/run_*
```

### 手动清理状态
如果状态文件损坏，可以手动删除：
```bash
rm logs/batch_status.json
```

## 使用 Screen 或 Tmux（替代方案）

如果更喜欢使用 screen/tmux：

```bash
# 使用 screen
screen -S batch
python run_batch_auto.py
# 按 Ctrl+A+D 分离会话
screen -r batch  # 重新连接

# 使用 tmux
tmux new -s batch
python run_batch_auto.py
# 按 Ctrl+B+D 分离会话
tmux attach -t batch  # 重新连接
```