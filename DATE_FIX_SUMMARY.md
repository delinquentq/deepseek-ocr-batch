# æ—¥æœŸè¯†åˆ«é”™è¯¯ä¿®å¤æ€»ç»“

## ğŸ“‹ é—®é¢˜æè¿°

**å‘ç°çš„é—®é¢˜ï¼š**
- `output_report/` å’Œ `output_results/` ä¸­å­˜åœ¨æ—¥æœŸä¸º `2025-12-31` çš„æ–‡ä»¶å¤¹
- è¿™äº›æ—¥æœŸæ˜¯é”™è¯¯çš„ï¼ˆå½“å‰ä¸º2025å¹´10æœˆï¼Œ12æœˆ31æ—¥è¿˜æœªåˆ°è¾¾ï¼‰
- é—®é¢˜æºäº PDF æ–‡ä»¶åæœ¬èº«å¸¦æœ‰é”™è¯¯çš„æ—¥æœŸåç¼€

## ğŸ” åŸå› åˆ†æ

**æ ¹æœ¬åŸå› ï¼š**
PDF æ–‡ä»¶åœ¨å‘½åæ—¶ï¼Œæ—¥æœŸåç¼€è¢«é”™è¯¯æ ‡è®°ä¸º `_2025-12-31.pdf`ï¼Œå¯¼è‡´ç³»ç»Ÿä»æ–‡ä»¶åä¸­æå–æ—¥æœŸæ—¶ä½¿ç”¨äº†é”™è¯¯çš„å€¼ã€‚

**ç¤ºä¾‹ï¼š**
```
é”™è¯¯çš„PDFæ–‡ä»¶åï¼š
Bank of Beijing - A 2Q25 Mixed Profits_2025-12-31.pdf

å®é™…åº”è¯¥æ˜¯ï¼š
Bank of Beijing - A 2Q25 Mixed Profits_2025-09-03.pdf
```

## âœ… ä¿®å¤æ–¹æ¡ˆ

åˆ›å»ºäº†ä¸¤ä¸ªä¿®å¤è„šæœ¬ï¼š

### 1. `fix_wrong_dates.py` - ä¿®å¤ output_report

**åŠŸèƒ½ï¼š**
- æ‰«æ `output_report/` ä¸­é”™è¯¯æ—¥æœŸçš„ JSON æ–‡ä»¶
- ä»å¯¹åº” PDF çš„æ–‡ä»¶ä¿®æ”¹æ—¶é—´ä¸­æå–æ­£ç¡®æ—¥æœŸ
- å°†æ–‡ä»¶ç§»åŠ¨åˆ°æ­£ç¡®çš„æ—¥æœŸç›®å½•

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
python fix_wrong_dates.py --yes
```

### 2. `fix_output_results_dates.py` - ä¿®å¤ output_results

**åŠŸèƒ½ï¼š**
- æ‰«æ `output_results/` ä¸­é”™è¯¯æ—¥æœŸçš„æ–‡ä»¶å¤¹
- ä»å¯¹åº” PDF çš„æ–‡ä»¶ä¿®æ”¹æ—¶é—´ä¸­æå–æ­£ç¡®æ—¥æœŸ
- å°†æ•´ä¸ªæ–‡ä»¶å¤¹ç§»åŠ¨åˆ°æ­£ç¡®çš„æ—¥æœŸç›®å½•

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
python fix_output_results_dates.py --yes
```

## ğŸ“Š ä¿®å¤ç»“æœ

### output_report ä¿®å¤

**ä¿®å¤å‰ï¼š**
```
output_report/2025-12-31/
â”œâ”€â”€ Bank of Beijing...json (8ä¸ªæ–‡ä»¶)
â”œâ”€â”€ Bank of Hangzhou...json
â”œâ”€â”€ ...
```

**ä¿®å¤åï¼š**
```
output_report/2025-09-02/
â”œâ”€â”€ Bank of Hangzhou...json (4ä¸ªæ–‡ä»¶)
â”œâ”€â”€ China Taiping...json
â””â”€â”€ ...

output_report/2025-09-03/
â”œâ”€â”€ Bank of Beijing...json (4ä¸ªæ–‡ä»¶)
â”œâ”€â”€ Bank of Nanjing...json
â””â”€â”€ ...

âœ… 2025-12-31/ ç›®å½•å·²åˆ é™¤
```

**ç»Ÿè®¡ï¼š**
- ä¿®å¤æ–‡ä»¶æ•°ï¼š8ä¸ª JSON æ–‡ä»¶
- å¤±è´¥æ•°ï¼š0
- æ–°æ—¥æœŸåˆ†å¸ƒï¼š
  - 2025-09-02: 4ä¸ªæ–‡ä»¶
  - 2025-09-03: 4ä¸ªæ–‡ä»¶

### output_results ä¿®å¤

**ä¿®å¤å‰ï¼š**
```
output_results/2025-12-31/
â”œâ”€â”€ Bank of Beijing.../  (6ä¸ªæ–‡ä»¶å¤¹)
â”œâ”€â”€ Bank of Hangzhou.../
â”œâ”€â”€ ...
```

**ä¿®å¤åï¼š**
```
output_results/2025-09-02/
â”œâ”€â”€ Bank of Hangzhou.../ (2ä¸ªæ–‡ä»¶å¤¹)
â”œâ”€â”€ China Taiping.../
â””â”€â”€ ...

output_results/2025-09-03/
â”œâ”€â”€ Bank of Beijing.../ (4ä¸ªæ–‡ä»¶å¤¹)
â”œâ”€â”€ Bank of Nanjing.../
â””â”€â”€ ...

âœ… 2025-12-31/ ç›®å½•å·²åˆ é™¤
```

**ç»Ÿè®¡ï¼š**
- ä¿®å¤æ–‡ä»¶å¤¹æ•°ï¼š6ä¸ª
- å¤±è´¥æ•°ï¼š0
- æ–°æ—¥æœŸåˆ†å¸ƒï¼š
  - 2025-09-02: 2ä¸ªæ–‡ä»¶å¤¹
  - 2025-09-03: 4ä¸ªæ–‡ä»¶å¤¹

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ—¥æœŸæå–é€»è¾‘

1. **ä¼˜å…ˆçº§1ï¼šPDFå…ƒæ•°æ®** (å¦‚æœæœ‰ PyMuPDF)
   - ä» PDF çš„ `creationDate` æˆ– `modDate` å­—æ®µæå–
   - æ ¼å¼ï¼š`D:20250903...` â†’ `2025-09-03`

2. **ä¼˜å…ˆçº§2ï¼šæ–‡ä»¶ä¿®æ”¹æ—¶é—´** (fallback)
   - ä½¿ç”¨ `os.path.getmtime()` è·å–æ–‡ä»¶ä¿®æ”¹æ—¶é—´
   - è½¬æ¢ä¸º `YYYY-MM-DD` æ ¼å¼

3. **éªŒè¯è§„åˆ™ï¼š**
   - åªæ¥å— 2025 å¹´ 1-10 æœˆçš„æ—¥æœŸ
   - è¶…å‡ºèŒƒå›´çš„æ—¥æœŸè§†ä¸ºæ— æ•ˆ

### ä¿®å¤æµç¨‹

```
1. æ‰«æé”™è¯¯æ—¥æœŸç›®å½•
   â†“
2. éå†æ¯ä¸ªJSON/æ–‡ä»¶å¤¹
   â†“
3. åœ¨ input_pdfs/ ä¸­æŸ¥æ‰¾å¯¹åº”PDF
   â†“
4. ä»PDFæå–æ­£ç¡®æ—¥æœŸ
   â†“
5. åˆ›å»ºæ­£ç¡®æ—¥æœŸç›®å½•
   â†“
6. ç§»åŠ¨æ–‡ä»¶/æ–‡ä»¶å¤¹
   â†“
7. åˆ é™¤ç©ºçš„é”™è¯¯æ—¥æœŸç›®å½•
```

## ğŸ“ æ‰§è¡Œè®°å½•

### ç¬¬ä¸€æ­¥ï¼šä¿®å¤ output_report

```bash
$ python fix_wrong_dates.py --yes

ğŸ” ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥éœ€è¦ä¿®å¤çš„æ–‡ä»¶ï¼ˆDRY RUNï¼‰
ğŸ“ å¤„ç†ç›®å½•: 2025-12-31 (8 ä¸ªJSONæ–‡ä»¶)
  âœ… æ‰¾åˆ°å¯¹åº”PDFï¼Œæå–æ—¥æœŸ
  ğŸ”„ å°†ç§»åŠ¨åˆ°æ­£ç¡®ç›®å½•

ğŸ”§ ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œä¿®å¤...
âœ… ä¿®å¤ 8 ä¸ªæ–‡ä»¶ï¼Œå¤±è´¥ 0 ä¸ª
ğŸ—‘ï¸ å·²åˆ é™¤ç©ºç›®å½•: 2025-12-31
```

### ç¬¬äºŒæ­¥ï¼šä¿®å¤ output_results

```bash
$ python fix_output_results_dates.py --yes

ğŸ” ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥éœ€è¦ä¿®å¤çš„æ–‡ä»¶å¤¹ï¼ˆDRY RUNï¼‰
ğŸ“ å¤„ç†ç›®å½•: 2025-12-31 (6 ä¸ªæ–‡ä»¶å¤¹)
  âœ… æ‰¾åˆ°å¯¹åº”PDFï¼Œæå–æ—¥æœŸ
  ğŸ”„ å°†ç§»åŠ¨åˆ°æ­£ç¡®ç›®å½•

ğŸ”§ ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œä¿®å¤...
âœ… ä¿®å¤ 6 ä¸ªæ–‡ä»¶å¤¹ï¼Œå¤±è´¥ 0 ä¸ª
ğŸ—‘ï¸ å·²åˆ é™¤ç©ºç›®å½•: 2025-12-31
```

## âœ… éªŒè¯ç»“æœ

```bash
# éªŒè¯ output_report
$ find output_report -name "2025-12-31" -type d
# (æ— è¾“å‡º - ç›®å½•å·²åˆ é™¤)

# éªŒè¯ output_results
$ find output_results -name "2025-12-31" -type d
# (æ— è¾“å‡º - ç›®å½•å·²åˆ é™¤)

# ç¡®è®¤æ–‡ä»¶å·²ç§»åŠ¨
$ ls output_report/2025-09-02/*.json | wc -l
106  # åŒ…å«æ–°ç§»åŠ¨çš„4ä¸ªæ–‡ä»¶

$ ls output_report/2025-09-03/*.json | wc -l
4    # æ–°ç§»åŠ¨çš„4ä¸ªæ–‡ä»¶
```

## ğŸ¯ åç»­å»ºè®®

### 1. ä¿®å¤ input_pdfs ä¸­çš„PDFæ–‡ä»¶å

**é—®é¢˜ï¼š** PDF æ–‡ä»¶åæœ¬èº«å¸¦æœ‰é”™è¯¯æ—¥æœŸåç¼€

**å»ºè®®ï¼š** åˆ›å»ºæ‰¹é‡é‡å‘½åè„šæœ¬
```bash
# ç¤ºä¾‹
mv "Bank of Beijing_2025-12-31.pdf" "Bank of Beijing_2025-09-03.pdf"
```

### 2. æ”¹è¿›æ—¥æœŸæå–é€»è¾‘

**å½“å‰é—®é¢˜ï¼š** ç³»ç»Ÿä»æ–‡ä»¶åæå–æ—¥æœŸï¼Œå¦‚æœæ–‡ä»¶åé”™è¯¯åˆ™ç»“æœä¹Ÿé”™è¯¯

**æ”¹è¿›æ–¹æ¡ˆï¼š**
- ä¼˜å…ˆä» PDF å…ƒæ•°æ®æå–æ—¥æœŸ
- æ·»åŠ æ—¥æœŸåˆç†æ€§æ£€æŸ¥ï¼ˆä¸æ¥å—æœªæ¥æ—¥æœŸï¼‰
- åœ¨å¤„ç†æ—¶è®°å½•è­¦å‘Šæ—¥å¿—

**ä»£ç ä½ç½®ï¼š** `batch_pdf_processor.py` ä¸­çš„æ—¥æœŸæå–å‡½æ•°

### 3. æ·»åŠ æ—¥æœŸéªŒè¯åˆ°å¤„ç†æµç¨‹

åœ¨ `batch_pdf_processor.py` ä¸­æ·»åŠ éªŒè¯ï¼š
```python
def validate_date(date_str: str) -> bool:
    """éªŒè¯æ—¥æœŸæ˜¯å¦åˆç†"""
    try:
        dt = datetime.strptime(date_str, "%Y-%m-%d")
        now = datetime.now()
        # ä¸æ¥å—æœªæ¥æ—¥æœŸ
        if dt > now:
            return False
        # ä¸æ¥å—è¿‡è€çš„æ—¥æœŸï¼ˆæ¯”å¦‚2020å¹´ä¹‹å‰ï¼‰
        if dt.year < 2020:
            return False
        return True
    except ValueError:
        return False
```

## ğŸ“‚ ç›¸å…³æ–‡ä»¶

**ä¿®å¤è„šæœ¬ï¼š**
- `fix_wrong_dates.py` - output_report ä¿®å¤è„šæœ¬
- `fix_output_results_dates.py` - output_results ä¿®å¤è„šæœ¬

**å½±å“çš„ç›®å½•ï¼š**
- `output_report/2025-12-31/` â†’ å·²åˆ é™¤
- `output_results/2025-12-31/` â†’ å·²åˆ é™¤
- `output_report/2025-09-02/` â† æ–°å¢4ä¸ªæ–‡ä»¶
- `output_report/2025-09-03/` â† æ–°å¢4ä¸ªæ–‡ä»¶
- `output_results/2025-09-02/` â† æ–°å¢2ä¸ªæ–‡ä»¶å¤¹
- `output_results/2025-09-03/` â† æ–°å¢4ä¸ªæ–‡ä»¶å¤¹

## ğŸ”’ å®‰å…¨æªæ–½

**è„šæœ¬ç‰¹æ€§ï¼š**
1. âœ… Dry-run æ¨¡å¼ï¼šå…ˆé¢„è§ˆå†æ‰§è¡Œ
2. âœ… ç›®æ ‡æ–‡ä»¶å­˜åœ¨æ£€æŸ¥ï¼šé¿å…è¦†ç›–
3. âœ… é”™è¯¯å¤„ç†ï¼šè®°å½•å¤±è´¥çš„æ–‡ä»¶
4. âœ… è‡ªåŠ¨åˆ é™¤ç©ºç›®å½•ï¼šä¿æŒç›®å½•æ•´æ´
5. âœ… è¯¦ç»†æ—¥å¿—ï¼šæ¯ä¸ªæ“ä½œéƒ½æœ‰è®°å½•

**æ‰§è¡Œå»ºè®®ï¼š**
- é¦–æ¬¡è¿è¡Œå…ˆä¸åŠ  `--yes` å‚æ•°ï¼ŒæŸ¥çœ‹ dry-run ç»“æœ
- ç¡®è®¤æ— è¯¯åå†åŠ  `--yes` è‡ªåŠ¨æ‰§è¡Œ
- é‡è¦æ•°æ®å…ˆå¤‡ä»½

---

**ä¿®å¤æ—¥æœŸï¼š** 2025-10-27
**ä¿®å¤è€…ï¼š** Claude Code
**é—®é¢˜æŠ¥å‘Šè€…ï¼š** ç”¨æˆ·
**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ
**å½±å“æ–‡ä»¶æ•°ï¼š** 14ä¸ªï¼ˆ8ä¸ªJSON + 6ä¸ªæ–‡ä»¶å¤¹ï¼‰
